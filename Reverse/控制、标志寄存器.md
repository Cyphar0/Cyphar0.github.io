## 控制、标志寄存器

### 控制寄存器

5个控制寄存器用于确定 CPU 的运行模式和当前执行任务的特性

**CR0**：控制处理器运行模式和各种状态的系统标志

**CR1**：（当前未实现）

**CR2**：内存页故障信息

**CR3**：内存页目录信息

**CR4**：启用处理器羽化并指示处理器功能部件的标志

每个控制寄存器中的值不能直接访问，但是控制寄存器中的数据可以移动到其中一个通用寄存器，一旦数据位于 GP 寄存器中，程序就可以检查寄存器中的位标志，以确定处理器的运行状态与当前正在运行的任务

如果需要更改控制寄存器标志值，则可以更改 GP 寄存器中的数据，并将寄存器移动到 CR

低级系统编程器通常会修改控制寄存器中的值，普通应用程序通常不会修改控制寄存器项，但是它们可能会查询标志值以确定当前运行程序的主机处理器芯片的功能



### 标志寄存器

16位CPU中标志寄存器成为FLAGS，32位中标志寄存器也被拓展到32位，称为EFLAGS

有三种类型的标志，分别是状态标志、控制标志和系统标志。

#### 状态标志

**CF**：进位标志，产生进位时为1，否则为0

**PF**：奇偶标志，结果操作数中1的个数为偶数时为1，否则为0

**AF**：辅助进位标志，记录运算时第三位（半字节）产生的进位，有进位时为1，否则为0

**ZF：**零标志，运算结果为0时为1，否则为0

**SF**：符号标志，指示结果的正负，负为1，否则为0

**OF**：溢出标志，溢出时为1，否则为0

**DF**：方向标志，在串处理指令中用于控制方向



#### 系统标志

**TF**：陷阱标志，设置为启用单步模式，当处于此模式时，处理器一次只执行一个指令代码，等待信号执行下一条指令

**IF：**中断标志，控制处理器如何响应从外部源接收的信号

**IOPL**：I/O 权限级别标志，指示当前正在运行的任务的输入-输出权限级别，并定义输入-输出地址空间的访问级别，该访问级别必须小于或等于访问相应地址空间所需的访问级别；如果地址空间不小于或等于所需的访问级别，则访问地址空间的任何请求都将被拒绝

**NT**：嵌套任务标志，控制当前正在运行的任务是否链接到之前执行的任务，并用于链接中断和调用的任务

**RF**：恢复标志，控制处理器在调试模式下如何响应异常

**VM：**Virtual-8086 模式标志，指示处理器在 virtual-8086 模式下运行，而不是 protected 或 real 模式

**AC**：对齐检查标志，与 CR0 控制寄存器中的 AM 位结合使用，以启用内存引用的对齐检查

**VIF** ：虚拟中断标志，在虚拟模式下运行时，虚拟中断标志会复制 IF 标志

**VIP**：虚拟中断挂起标志，在虚拟模式下运行时，使用虚拟中断挂起标志来指示 n 个中断处于待办状态

**ID**：识别标志，指示处理器是否支持 CPUID 指令